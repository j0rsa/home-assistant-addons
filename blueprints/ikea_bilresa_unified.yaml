blueprint:
  name: "IKEA Bilresa – Unified 3-Layer Controller"
  description: "Complete control for IKEA Bilresa with 3 layers × 3 buttons. Left/Right buttons adjust brightness, Center buttons have full multi-press and hold support."
  domain: automation

  input:
    # ╔══════════════════════════════════════════════════════════════════════════╗
    # ║                              LAYER 1                                     ║
    # ╚══════════════════════════════════════════════════════════════════════════╝
    layer1_light:
      name: "══════════ LAYER 1 ══════════ Target Light"
      description: "The light controlled by all buttons on Layer 1"
      selector:
        entity:
          domain: light
      default: ""

    # --- Layer 1: Left Button ---
    layer1_left_event:
      name: "Layer 1 – Left Button Event"
      selector:
        entity:
          domain: event
      default: ""

    layer1_left_direction:
      name: "Layer 1 – Left Button Direction"
      selector:
        select:
          options:
            - label: "Increase brightness"
              value: "up"
            - label: "Decrease brightness"
              value: "down"
      default: "down"

    layer1_left_step:
      name: "Layer 1 – Left Button Step (%)"
      default: 10
      selector:
        number:
          min: 1
          max: 50
          unit_of_measurement: "%"

    # --- Layer 1: Right Button ---
    layer1_right_event:
      name: "Layer 1 – Right Button Event"
      selector:
        entity:
          domain: event
      default: ""

    layer1_right_direction:
      name: "Layer 1 – Right Button Direction"
      selector:
        select:
          options:
            - label: "Increase brightness"
              value: "up"
            - label: "Decrease brightness"
              value: "down"
      default: "up"

    layer1_right_step:
      name: "Layer 1 – Right Button Step (%)"
      default: 10
      selector:
        number:
          min: 1
          max: 50
          unit_of_measurement: "%"

    # --- Layer 1: Center Button ---
    layer1_center_event:
      name: "Layer 1 – Center Button Event"
      selector:
        entity:
          domain: event
      default: ""

    layer1_center_single_type:
      name: "Layer 1 – Center 1× Type"
      selector:
        select:
          options:
            - label: "Light"
              value: "light"
            - label: "Scene"
              value: "scene"
            - label: "Cover"
              value: "cover"
      default: "light"

    layer1_center_single_action:
      name: "Layer 1 – Center 1× Light Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Turn on"
              value: "turn_on"
            - label: "Turn off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "toggle"

    layer1_center_single_scene:
      name: "Layer 1 – Center 1× Scene"
      selector:
        entity:
          domain: scene
      default: ""

    layer1_center_single_cover:
      name: "Layer 1 – Center 1× Cover"
      selector:
        entity:
          domain: cover
      default: ""

    layer1_center_single_cover_action:
      name: "Layer 1 – Center 1× Cover Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Open"
              value: "open"
            - label: "Close"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "toggle"

    layer1_center_double_type:
      name: "Layer 1 – Center 2× Type"
      selector:
        select:
          options:
            - label: "Light"
              value: "light"
            - label: "Scene"
              value: "scene"
            - label: "Cover"
              value: "cover"
      default: "light"

    layer1_center_double_action:
      name: "Layer 1 – Center 2× Light Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Turn on"
              value: "turn_on"
            - label: "Turn off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "brightness_50"

    layer1_center_double_scene:
      name: "Layer 1 – Center 2× Scene"
      selector:
        entity:
          domain: scene
      default: ""

    layer1_center_double_cover:
      name: "Layer 1 – Center 2× Cover"
      selector:
        entity:
          domain: cover
      default: ""

    layer1_center_double_cover_action:
      name: "Layer 1 – Center 2× Cover Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Open"
              value: "open"
            - label: "Close"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "toggle"

    layer1_center_triple_type:
      name: "Layer 1 – Center 3× Type"
      selector:
        select:
          options:
            - label: "Light"
              value: "light"
            - label: "Scene"
              value: "scene"
            - label: "Cover"
              value: "cover"
      default: "light"

    layer1_center_triple_action:
      name: "Layer 1 – Center 3× Light Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Turn on"
              value: "turn_on"
            - label: "Turn off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "brightness_100"

    layer1_center_triple_scene:
      name: "Layer 1 – Center 3× Scene"
      selector:
        entity:
          domain: scene
      default: ""

    layer1_center_triple_cover:
      name: "Layer 1 – Center 3× Cover"
      selector:
        entity:
          domain: cover
      default: ""

    layer1_center_triple_cover_action:
      name: "Layer 1 – Center 3× Cover Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Open"
              value: "open"
            - label: "Close"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "toggle"

    layer1_center_hold_type:
      name: "Layer 1 – Center Hold Type"
      selector:
        select:
          options:
            - label: "Light"
              value: "light"
            - label: "Scene"
              value: "scene"
            - label: "Cover"
              value: "cover"
      default: "light"

    layer1_center_hold_action:
      name: "Layer 1 – Center Hold Light Action"
      selector:
        select:
          options:
            - label: "Brightness step (dimming)"
              value: "brightness_step"
            - label: "Toggle"
              value: "toggle"
            - label: "Turn on"
              value: "turn_on"
            - label: "Turn off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "brightness_step"

    layer1_center_hold_direction:
      name: "Layer 1 – Center Hold Direction"
      selector:
        select:
          options:
            - label: "Increase brightness"
              value: "up"
            - label: "Decrease brightness"
              value: "down"
      default: "up"

    layer1_center_hold_step:
      name: "Layer 1 – Center Hold Step (%)"
      default: 5
      selector:
        number:
          min: 1
          max: 20
          unit_of_measurement: "%"

    layer1_center_hold_scene:
      name: "Layer 1 – Center Hold Scene"
      selector:
        entity:
          domain: scene
      default: ""

    layer1_center_hold_cover:
      name: "Layer 1 – Center Hold Cover"
      selector:
        entity:
          domain: cover
      default: ""

    layer1_center_hold_cover_action:
      name: "Layer 1 – Center Hold Cover Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Open"
              value: "open"
            - label: "Close"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "toggle"

    # ╔══════════════════════════════════════════════════════════════════════════╗
    # ║                              LAYER 2                                     ║
    # ╚══════════════════════════════════════════════════════════════════════════╝
    layer2_light:
      name: "══════════ LAYER 2 ══════════ Target Light"
      description: "The light controlled by all buttons on Layer 2"
      selector:
        entity:
          domain: light
      default: ""

    # --- Layer 2: Left Button ---
    layer2_left_event:
      name: "Layer 2 – Left Button Event"
      selector:
        entity:
          domain: event
      default: ""

    layer2_left_direction:
      name: "Layer 2 – Left Button Direction"
      selector:
        select:
          options:
            - label: "Increase brightness"
              value: "up"
            - label: "Decrease brightness"
              value: "down"
      default: "down"

    layer2_left_step:
      name: "Layer 2 – Left Button Step (%)"
      default: 10
      selector:
        number:
          min: 1
          max: 50
          unit_of_measurement: "%"

    # --- Layer 2: Right Button ---
    layer2_right_event:
      name: "Layer 2 – Right Button Event"
      selector:
        entity:
          domain: event
      default: ""

    layer2_right_direction:
      name: "Layer 2 – Right Button Direction"
      selector:
        select:
          options:
            - label: "Increase brightness"
              value: "up"
            - label: "Decrease brightness"
              value: "down"
      default: "up"

    layer2_right_step:
      name: "Layer 2 – Right Button Step (%)"
      default: 10
      selector:
        number:
          min: 1
          max: 50
          unit_of_measurement: "%"

    # --- Layer 2: Center Button ---
    layer2_center_event:
      name: "Layer 2 – Center Button Event"
      selector:
        entity:
          domain: event
      default: ""

    layer2_center_single_type:
      name: "Layer 2 – Center 1× Type"
      selector:
        select:
          options:
            - label: "Light"
              value: "light"
            - label: "Scene"
              value: "scene"
            - label: "Cover"
              value: "cover"
      default: "light"

    layer2_center_single_action:
      name: "Layer 2 – Center 1× Light Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Turn on"
              value: "turn_on"
            - label: "Turn off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "toggle"

    layer2_center_single_scene:
      name: "Layer 2 – Center 1× Scene"
      selector:
        entity:
          domain: scene
      default: ""

    layer2_center_single_cover:
      name: "Layer 2 – Center 1× Cover"
      selector:
        entity:
          domain: cover
      default: ""

    layer2_center_single_cover_action:
      name: "Layer 2 – Center 1× Cover Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Open"
              value: "open"
            - label: "Close"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "toggle"

    layer2_center_double_type:
      name: "Layer 2 – Center 2× Type"
      selector:
        select:
          options:
            - label: "Light"
              value: "light"
            - label: "Scene"
              value: "scene"
            - label: "Cover"
              value: "cover"
      default: "light"

    layer2_center_double_action:
      name: "Layer 2 – Center 2× Light Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Turn on"
              value: "turn_on"
            - label: "Turn off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "brightness_50"

    layer2_center_double_scene:
      name: "Layer 2 – Center 2× Scene"
      selector:
        entity:
          domain: scene
      default: ""

    layer2_center_double_cover:
      name: "Layer 2 – Center 2× Cover"
      selector:
        entity:
          domain: cover
      default: ""

    layer2_center_double_cover_action:
      name: "Layer 2 – Center 2× Cover Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Open"
              value: "open"
            - label: "Close"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "toggle"

    layer2_center_triple_type:
      name: "Layer 2 – Center 3× Type"
      selector:
        select:
          options:
            - label: "Light"
              value: "light"
            - label: "Scene"
              value: "scene"
            - label: "Cover"
              value: "cover"
      default: "light"

    layer2_center_triple_action:
      name: "Layer 2 – Center 3× Light Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Turn on"
              value: "turn_on"
            - label: "Turn off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "brightness_100"

    layer2_center_triple_scene:
      name: "Layer 2 – Center 3× Scene"
      selector:
        entity:
          domain: scene
      default: ""

    layer2_center_triple_cover:
      name: "Layer 2 – Center 3× Cover"
      selector:
        entity:
          domain: cover
      default: ""

    layer2_center_triple_cover_action:
      name: "Layer 2 – Center 3× Cover Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Open"
              value: "open"
            - label: "Close"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "toggle"

    layer2_center_hold_type:
      name: "Layer 2 – Center Hold Type"
      selector:
        select:
          options:
            - label: "Light"
              value: "light"
            - label: "Scene"
              value: "scene"
            - label: "Cover"
              value: "cover"
      default: "light"

    layer2_center_hold_action:
      name: "Layer 2 – Center Hold Light Action"
      selector:
        select:
          options:
            - label: "Brightness step (dimming)"
              value: "brightness_step"
            - label: "Toggle"
              value: "toggle"
            - label: "Turn on"
              value: "turn_on"
            - label: "Turn off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "brightness_step"

    layer2_center_hold_direction:
      name: "Layer 2 – Center Hold Direction"
      selector:
        select:
          options:
            - label: "Increase brightness"
              value: "up"
            - label: "Decrease brightness"
              value: "down"
      default: "up"

    layer2_center_hold_step:
      name: "Layer 2 – Center Hold Step (%)"
      default: 5
      selector:
        number:
          min: 1
          max: 20
          unit_of_measurement: "%"

    layer2_center_hold_scene:
      name: "Layer 2 – Center Hold Scene"
      selector:
        entity:
          domain: scene
      default: ""

    layer2_center_hold_cover:
      name: "Layer 2 – Center Hold Cover"
      selector:
        entity:
          domain: cover
      default: ""

    layer2_center_hold_cover_action:
      name: "Layer 2 – Center Hold Cover Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Open"
              value: "open"
            - label: "Close"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "toggle"

    # ╔══════════════════════════════════════════════════════════════════════════╗
    # ║                              LAYER 3                                     ║
    # ╚══════════════════════════════════════════════════════════════════════════╝
    layer3_light:
      name: "══════════ LAYER 3 ══════════ Target Light"
      description: "The light controlled by all buttons on Layer 3"
      selector:
        entity:
          domain: light
      default: ""

    # --- Layer 3: Left Button ---
    layer3_left_event:
      name: "Layer 3 – Left Button Event"
      selector:
        entity:
          domain: event
      default: ""

    layer3_left_direction:
      name: "Layer 3 – Left Button Direction"
      selector:
        select:
          options:
            - label: "Increase brightness"
              value: "up"
            - label: "Decrease brightness"
              value: "down"
      default: "down"

    layer3_left_step:
      name: "Layer 3 – Left Button Step (%)"
      default: 10
      selector:
        number:
          min: 1
          max: 50
          unit_of_measurement: "%"

    # --- Layer 3: Right Button ---
    layer3_right_event:
      name: "Layer 3 – Right Button Event"
      selector:
        entity:
          domain: event
      default: ""

    layer3_right_direction:
      name: "Layer 3 – Right Button Direction"
      selector:
        select:
          options:
            - label: "Increase brightness"
              value: "up"
            - label: "Decrease brightness"
              value: "down"
      default: "up"

    layer3_right_step:
      name: "Layer 3 – Right Button Step (%)"
      default: 10
      selector:
        number:
          min: 1
          max: 50
          unit_of_measurement: "%"

    # --- Layer 3: Center Button ---
    layer3_center_event:
      name: "Layer 3 – Center Button Event"
      selector:
        entity:
          domain: event
      default: ""

    layer3_center_single_type:
      name: "Layer 3 – Center 1× Type"
      selector:
        select:
          options:
            - label: "Light"
              value: "light"
            - label: "Scene"
              value: "scene"
            - label: "Cover"
              value: "cover"
      default: "light"

    layer3_center_single_action:
      name: "Layer 3 – Center 1× Light Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Turn on"
              value: "turn_on"
            - label: "Turn off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "toggle"

    layer3_center_single_scene:
      name: "Layer 3 – Center 1× Scene"
      selector:
        entity:
          domain: scene
      default: ""

    layer3_center_single_cover:
      name: "Layer 3 – Center 1× Cover"
      selector:
        entity:
          domain: cover
      default: ""

    layer3_center_single_cover_action:
      name: "Layer 3 – Center 1× Cover Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Open"
              value: "open"
            - label: "Close"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "toggle"

    layer3_center_double_type:
      name: "Layer 3 – Center 2× Type"
      selector:
        select:
          options:
            - label: "Light"
              value: "light"
            - label: "Scene"
              value: "scene"
            - label: "Cover"
              value: "cover"
      default: "light"

    layer3_center_double_action:
      name: "Layer 3 – Center 2× Light Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Turn on"
              value: "turn_on"
            - label: "Turn off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "brightness_50"

    layer3_center_double_scene:
      name: "Layer 3 – Center 2× Scene"
      selector:
        entity:
          domain: scene
      default: ""

    layer3_center_double_cover:
      name: "Layer 3 – Center 2× Cover"
      selector:
        entity:
          domain: cover
      default: ""

    layer3_center_double_cover_action:
      name: "Layer 3 – Center 2× Cover Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Open"
              value: "open"
            - label: "Close"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "toggle"

    layer3_center_triple_type:
      name: "Layer 3 – Center 3× Type"
      selector:
        select:
          options:
            - label: "Light"
              value: "light"
            - label: "Scene"
              value: "scene"
            - label: "Cover"
              value: "cover"
      default: "light"

    layer3_center_triple_action:
      name: "Layer 3 – Center 3× Light Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Turn on"
              value: "turn_on"
            - label: "Turn off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "brightness_100"

    layer3_center_triple_scene:
      name: "Layer 3 – Center 3× Scene"
      selector:
        entity:
          domain: scene
      default: ""

    layer3_center_triple_cover:
      name: "Layer 3 – Center 3× Cover"
      selector:
        entity:
          domain: cover
      default: ""

    layer3_center_triple_cover_action:
      name: "Layer 3 – Center 3× Cover Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Open"
              value: "open"
            - label: "Close"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "toggle"

    layer3_center_hold_type:
      name: "Layer 3 – Center Hold Type"
      selector:
        select:
          options:
            - label: "Light"
              value: "light"
            - label: "Scene"
              value: "scene"
            - label: "Cover"
              value: "cover"
      default: "light"

    layer3_center_hold_action:
      name: "Layer 3 – Center Hold Light Action"
      selector:
        select:
          options:
            - label: "Brightness step (dimming)"
              value: "brightness_step"
            - label: "Toggle"
              value: "toggle"
            - label: "Turn on"
              value: "turn_on"
            - label: "Turn off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "brightness_step"

    layer3_center_hold_direction:
      name: "Layer 3 – Center Hold Direction"
      selector:
        select:
          options:
            - label: "Increase brightness"
              value: "up"
            - label: "Decrease brightness"
              value: "down"
      default: "up"

    layer3_center_hold_step:
      name: "Layer 3 – Center Hold Step (%)"
      default: 5
      selector:
        number:
          min: 1
          max: 20
          unit_of_measurement: "%"

    layer3_center_hold_scene:
      name: "Layer 3 – Center Hold Scene"
      selector:
        entity:
          domain: scene
      default: ""

    layer3_center_hold_cover:
      name: "Layer 3 – Center Hold Cover"
      selector:
        entity:
          domain: cover
      default: ""

    layer3_center_hold_cover_action:
      name: "Layer 3 – Center Hold Cover Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Open"
              value: "open"
            - label: "Close"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "toggle"

trigger:
  - platform: state
    entity_id: !input layer1_left_event
    id: l1_left
  - platform: state
    entity_id: !input layer1_center_event
    id: l1_center
  - platform: state
    entity_id: !input layer1_right_event
    id: l1_right
  - platform: state
    entity_id: !input layer2_left_event
    id: l2_left
  - platform: state
    entity_id: !input layer2_center_event
    id: l2_center
  - platform: state
    entity_id: !input layer2_right_event
    id: l2_right
  - platform: state
    entity_id: !input layer3_left_event
    id: l3_left
  - platform: state
    entity_id: !input layer3_center_event
    id: l3_center
  - platform: state
    entity_id: !input layer3_right_event
    id: l3_right

condition: []

action:
  - variables:
      event_type: "{{ state_attr(trigger.entity_id, 'event_type') }}"
      trigger_id: "{{ trigger.id }}"

      # Layer 1
      l1_light: !input layer1_light
      l1_left_dir: !input layer1_left_direction
      l1_left_step: !input layer1_left_step
      l1_center_single_type: !input layer1_center_single_type
      l1_center_single_action: !input layer1_center_single_action
      l1_center_single_scene: !input layer1_center_single_scene
      l1_center_single_cover: !input layer1_center_single_cover
      l1_center_single_cover_action: !input layer1_center_single_cover_action
      l1_center_double_type: !input layer1_center_double_type
      l1_center_double_action: !input layer1_center_double_action
      l1_center_double_scene: !input layer1_center_double_scene
      l1_center_double_cover: !input layer1_center_double_cover
      l1_center_double_cover_action: !input layer1_center_double_cover_action
      l1_center_triple_type: !input layer1_center_triple_type
      l1_center_triple_action: !input layer1_center_triple_action
      l1_center_triple_scene: !input layer1_center_triple_scene
      l1_center_triple_cover: !input layer1_center_triple_cover
      l1_center_triple_cover_action: !input layer1_center_triple_cover_action
      l1_center_hold_type: !input layer1_center_hold_type
      l1_center_hold_action: !input layer1_center_hold_action
      l1_center_hold_dir: !input layer1_center_hold_direction
      l1_center_hold_step: !input layer1_center_hold_step
      l1_center_hold_scene: !input layer1_center_hold_scene
      l1_center_hold_cover: !input layer1_center_hold_cover
      l1_center_hold_cover_action: !input layer1_center_hold_cover_action
      l1_right_dir: !input layer1_right_direction
      l1_right_step: !input layer1_right_step

      # Layer 2
      l2_light: !input layer2_light
      l2_left_dir: !input layer2_left_direction
      l2_left_step: !input layer2_left_step
      l2_center_single_type: !input layer2_center_single_type
      l2_center_single_action: !input layer2_center_single_action
      l2_center_single_scene: !input layer2_center_single_scene
      l2_center_single_cover: !input layer2_center_single_cover
      l2_center_single_cover_action: !input layer2_center_single_cover_action
      l2_center_double_type: !input layer2_center_double_type
      l2_center_double_action: !input layer2_center_double_action
      l2_center_double_scene: !input layer2_center_double_scene
      l2_center_double_cover: !input layer2_center_double_cover
      l2_center_double_cover_action: !input layer2_center_double_cover_action
      l2_center_triple_type: !input layer2_center_triple_type
      l2_center_triple_action: !input layer2_center_triple_action
      l2_center_triple_scene: !input layer2_center_triple_scene
      l2_center_triple_cover: !input layer2_center_triple_cover
      l2_center_triple_cover_action: !input layer2_center_triple_cover_action
      l2_center_hold_type: !input layer2_center_hold_type
      l2_center_hold_action: !input layer2_center_hold_action
      l2_center_hold_dir: !input layer2_center_hold_direction
      l2_center_hold_step: !input layer2_center_hold_step
      l2_center_hold_scene: !input layer2_center_hold_scene
      l2_center_hold_cover: !input layer2_center_hold_cover
      l2_center_hold_cover_action: !input layer2_center_hold_cover_action
      l2_right_dir: !input layer2_right_direction
      l2_right_step: !input layer2_right_step

      # Layer 3
      l3_light: !input layer3_light
      l3_left_dir: !input layer3_left_direction
      l3_left_step: !input layer3_left_step
      l3_center_single_type: !input layer3_center_single_type
      l3_center_single_action: !input layer3_center_single_action
      l3_center_single_scene: !input layer3_center_single_scene
      l3_center_single_cover: !input layer3_center_single_cover
      l3_center_single_cover_action: !input layer3_center_single_cover_action
      l3_center_double_type: !input layer3_center_double_type
      l3_center_double_action: !input layer3_center_double_action
      l3_center_double_scene: !input layer3_center_double_scene
      l3_center_double_cover: !input layer3_center_double_cover
      l3_center_double_cover_action: !input layer3_center_double_cover_action
      l3_center_triple_type: !input layer3_center_triple_type
      l3_center_triple_action: !input layer3_center_triple_action
      l3_center_triple_scene: !input layer3_center_triple_scene
      l3_center_triple_cover: !input layer3_center_triple_cover
      l3_center_triple_cover_action: !input layer3_center_triple_cover_action
      l3_center_hold_type: !input layer3_center_hold_type
      l3_center_hold_action: !input layer3_center_hold_action
      l3_center_hold_dir: !input layer3_center_hold_direction
      l3_center_hold_step: !input layer3_center_hold_step
      l3_center_hold_scene: !input layer3_center_hold_scene
      l3_center_hold_cover: !input layer3_center_hold_cover
      l3_center_hold_cover_action: !input layer3_center_hold_cover_action
      l3_right_dir: !input layer3_right_direction
      l3_right_step: !input layer3_right_step

  # ╔══════════════════════════════════════════════════════════════════════════╗
  # ║                         LAYER 1 ACTIONS                                  ║
  # ╚══════════════════════════════════════════════════════════════════════════╝

  # Layer 1 – Left (Brightness adjustment)
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l1_left' and event_type == 'multi_press_1' and l1_light != '' }}"
    then:
      - service: light.turn_on
        target:
          entity_id: "{{ l1_light }}"
        data:
          brightness_step_pct: "{{ l1_left_step if l1_left_dir == 'up' else -l1_left_step }}"

  # Layer 1 – Center Single Press
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l1_center' and event_type == 'multi_press_1' }}"
    then:
      - choose:
          - conditions: "{{ l1_center_single_type == 'scene' and l1_center_single_scene != '' }}"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: "{{ l1_center_single_scene }}"
          - conditions: "{{ l1_center_single_type == 'cover' and l1_center_single_cover != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l1_center_single_cover_action == 'toggle' }}"
                    sequence:
                      - service: cover.toggle
                        target:
                          entity_id: "{{ l1_center_single_cover }}"
                  - conditions: "{{ l1_center_single_cover_action == 'open' }}"
                    sequence:
                      - service: cover.open_cover
                        target:
                          entity_id: "{{ l1_center_single_cover }}"
                  - conditions: "{{ l1_center_single_cover_action == 'close' }}"
                    sequence:
                      - service: cover.close_cover
                        target:
                          entity_id: "{{ l1_center_single_cover }}"
                  - conditions: "{{ l1_center_single_cover_action == 'stop' }}"
                    sequence:
                      - service: cover.stop_cover
                        target:
                          entity_id: "{{ l1_center_single_cover }}"
          - conditions: "{{ l1_center_single_type == 'light' and l1_light != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l1_center_single_action == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ l1_light }}"
                  - conditions: "{{ l1_center_single_action == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                  - conditions: "{{ l1_center_single_action == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ l1_light }}"
                  - conditions: "{{ l1_center_single_action == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 25
                  - conditions: "{{ l1_center_single_action == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 50
                  - conditions: "{{ l1_center_single_action == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 75
                  - conditions: "{{ l1_center_single_action == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 100

  # Layer 1 – Center Double Press
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l1_center' and event_type == 'multi_press_2' }}"
    then:
      - choose:
          - conditions: "{{ l1_center_double_type == 'scene' and l1_center_double_scene != '' }}"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: "{{ l1_center_double_scene }}"
          - conditions: "{{ l1_center_double_type == 'cover' and l1_center_double_cover != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l1_center_double_cover_action == 'toggle' }}"
                    sequence:
                      - service: cover.toggle
                        target:
                          entity_id: "{{ l1_center_double_cover }}"
                  - conditions: "{{ l1_center_double_cover_action == 'open' }}"
                    sequence:
                      - service: cover.open_cover
                        target:
                          entity_id: "{{ l1_center_double_cover }}"
                  - conditions: "{{ l1_center_double_cover_action == 'close' }}"
                    sequence:
                      - service: cover.close_cover
                        target:
                          entity_id: "{{ l1_center_double_cover }}"
                  - conditions: "{{ l1_center_double_cover_action == 'stop' }}"
                    sequence:
                      - service: cover.stop_cover
                        target:
                          entity_id: "{{ l1_center_double_cover }}"
          - conditions: "{{ l1_center_double_type == 'light' and l1_light != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l1_center_double_action == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ l1_light }}"
                  - conditions: "{{ l1_center_double_action == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                  - conditions: "{{ l1_center_double_action == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ l1_light }}"
                  - conditions: "{{ l1_center_double_action == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 25
                  - conditions: "{{ l1_center_double_action == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 50
                  - conditions: "{{ l1_center_double_action == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 75
                  - conditions: "{{ l1_center_double_action == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 100

  # Layer 1 – Center Triple Press
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l1_center' and event_type == 'multi_press_3' }}"
    then:
      - choose:
          - conditions: "{{ l1_center_triple_type == 'scene' and l1_center_triple_scene != '' }}"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: "{{ l1_center_triple_scene }}"
          - conditions: "{{ l1_center_triple_type == 'cover' and l1_center_triple_cover != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l1_center_triple_cover_action == 'toggle' }}"
                    sequence:
                      - service: cover.toggle
                        target:
                          entity_id: "{{ l1_center_triple_cover }}"
                  - conditions: "{{ l1_center_triple_cover_action == 'open' }}"
                    sequence:
                      - service: cover.open_cover
                        target:
                          entity_id: "{{ l1_center_triple_cover }}"
                  - conditions: "{{ l1_center_triple_cover_action == 'close' }}"
                    sequence:
                      - service: cover.close_cover
                        target:
                          entity_id: "{{ l1_center_triple_cover }}"
                  - conditions: "{{ l1_center_triple_cover_action == 'stop' }}"
                    sequence:
                      - service: cover.stop_cover
                        target:
                          entity_id: "{{ l1_center_triple_cover }}"
          - conditions: "{{ l1_center_triple_type == 'light' and l1_light != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l1_center_triple_action == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ l1_light }}"
                  - conditions: "{{ l1_center_triple_action == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                  - conditions: "{{ l1_center_triple_action == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ l1_light }}"
                  - conditions: "{{ l1_center_triple_action == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 25
                  - conditions: "{{ l1_center_triple_action == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 50
                  - conditions: "{{ l1_center_triple_action == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 75
                  - conditions: "{{ l1_center_triple_action == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 100

  # Layer 1 – Center Hold
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l1_center' and (event_type == 'initial_press' or event_type == 'repeat') }}"
    then:
      - choose:
          - conditions: "{{ l1_center_hold_type == 'scene' and l1_center_hold_scene != '' }}"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: "{{ l1_center_hold_scene }}"
          - conditions: "{{ l1_center_hold_type == 'cover' and l1_center_hold_cover != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l1_center_hold_cover_action == 'toggle' }}"
                    sequence:
                      - service: cover.toggle
                        target:
                          entity_id: "{{ l1_center_hold_cover }}"
                  - conditions: "{{ l1_center_hold_cover_action == 'open' }}"
                    sequence:
                      - service: cover.open_cover
                        target:
                          entity_id: "{{ l1_center_hold_cover }}"
                  - conditions: "{{ l1_center_hold_cover_action == 'close' }}"
                    sequence:
                      - service: cover.close_cover
                        target:
                          entity_id: "{{ l1_center_hold_cover }}"
                  - conditions: "{{ l1_center_hold_cover_action == 'stop' }}"
                    sequence:
                      - service: cover.stop_cover
                        target:
                          entity_id: "{{ l1_center_hold_cover }}"
          - conditions: "{{ l1_center_hold_type == 'light' and l1_light != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l1_center_hold_action == 'brightness_step' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_step_pct: "{{ l1_center_hold_step if l1_center_hold_dir == 'up' else -l1_center_hold_step }}"
                  - conditions: "{{ l1_center_hold_action == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ l1_light }}"
                  - conditions: "{{ l1_center_hold_action == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                  - conditions: "{{ l1_center_hold_action == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ l1_light }}"
                  - conditions: "{{ l1_center_hold_action == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 25
                  - conditions: "{{ l1_center_hold_action == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 50
                  - conditions: "{{ l1_center_hold_action == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 75
                  - conditions: "{{ l1_center_hold_action == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l1_light }}"
                        data:
                          brightness_pct: 100

  # Layer 1 – Right (Brightness adjustment)
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l1_right' and event_type == 'multi_press_1' and l1_light != '' }}"
    then:
      - service: light.turn_on
        target:
          entity_id: "{{ l1_light }}"
        data:
          brightness_step_pct: "{{ l1_right_step if l1_right_dir == 'up' else -l1_right_step }}"

  # ╔══════════════════════════════════════════════════════════════════════════╗
  # ║                         LAYER 2 ACTIONS                                  ║
  # ╚══════════════════════════════════════════════════════════════════════════╝

  # Layer 2 – Left (Brightness adjustment)
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l2_left' and event_type == 'multi_press_1' and l2_light != '' }}"
    then:
      - service: light.turn_on
        target:
          entity_id: "{{ l2_light }}"
        data:
          brightness_step_pct: "{{ l2_left_step if l2_left_dir == 'up' else -l2_left_step }}"

  # Layer 2 – Center Single Press
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l2_center' and event_type == 'multi_press_1' }}"
    then:
      - choose:
          - conditions: "{{ l2_center_single_type == 'scene' and l2_center_single_scene != '' }}"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: "{{ l2_center_single_scene }}"
          - conditions: "{{ l2_center_single_type == 'cover' and l2_center_single_cover != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l2_center_single_cover_action == 'toggle' }}"
                    sequence:
                      - service: cover.toggle
                        target:
                          entity_id: "{{ l2_center_single_cover }}"
                  - conditions: "{{ l2_center_single_cover_action == 'open' }}"
                    sequence:
                      - service: cover.open_cover
                        target:
                          entity_id: "{{ l2_center_single_cover }}"
                  - conditions: "{{ l2_center_single_cover_action == 'close' }}"
                    sequence:
                      - service: cover.close_cover
                        target:
                          entity_id: "{{ l2_center_single_cover }}"
                  - conditions: "{{ l2_center_single_cover_action == 'stop' }}"
                    sequence:
                      - service: cover.stop_cover
                        target:
                          entity_id: "{{ l2_center_single_cover }}"
          - conditions: "{{ l2_center_single_type == 'light' and l2_light != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l2_center_single_action == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ l2_light }}"
                  - conditions: "{{ l2_center_single_action == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                  - conditions: "{{ l2_center_single_action == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ l2_light }}"
                  - conditions: "{{ l2_center_single_action == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 25
                  - conditions: "{{ l2_center_single_action == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 50
                  - conditions: "{{ l2_center_single_action == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 75
                  - conditions: "{{ l2_center_single_action == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 100

  # Layer 2 – Center Double Press
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l2_center' and event_type == 'multi_press_2' }}"
    then:
      - choose:
          - conditions: "{{ l2_center_double_type == 'scene' and l2_center_double_scene != '' }}"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: "{{ l2_center_double_scene }}"
          - conditions: "{{ l2_center_double_type == 'cover' and l2_center_double_cover != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l2_center_double_cover_action == 'toggle' }}"
                    sequence:
                      - service: cover.toggle
                        target:
                          entity_id: "{{ l2_center_double_cover }}"
                  - conditions: "{{ l2_center_double_cover_action == 'open' }}"
                    sequence:
                      - service: cover.open_cover
                        target:
                          entity_id: "{{ l2_center_double_cover }}"
                  - conditions: "{{ l2_center_double_cover_action == 'close' }}"
                    sequence:
                      - service: cover.close_cover
                        target:
                          entity_id: "{{ l2_center_double_cover }}"
                  - conditions: "{{ l2_center_double_cover_action == 'stop' }}"
                    sequence:
                      - service: cover.stop_cover
                        target:
                          entity_id: "{{ l2_center_double_cover }}"
          - conditions: "{{ l2_center_double_type == 'light' and l2_light != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l2_center_double_action == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ l2_light }}"
                  - conditions: "{{ l2_center_double_action == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                  - conditions: "{{ l2_center_double_action == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ l2_light }}"
                  - conditions: "{{ l2_center_double_action == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 25
                  - conditions: "{{ l2_center_double_action == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 50
                  - conditions: "{{ l2_center_double_action == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 75
                  - conditions: "{{ l2_center_double_action == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 100

  # Layer 2 – Center Triple Press
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l2_center' and event_type == 'multi_press_3' }}"
    then:
      - choose:
          - conditions: "{{ l2_center_triple_type == 'scene' and l2_center_triple_scene != '' }}"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: "{{ l2_center_triple_scene }}"
          - conditions: "{{ l2_center_triple_type == 'cover' and l2_center_triple_cover != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l2_center_triple_cover_action == 'toggle' }}"
                    sequence:
                      - service: cover.toggle
                        target:
                          entity_id: "{{ l2_center_triple_cover }}"
                  - conditions: "{{ l2_center_triple_cover_action == 'open' }}"
                    sequence:
                      - service: cover.open_cover
                        target:
                          entity_id: "{{ l2_center_triple_cover }}"
                  - conditions: "{{ l2_center_triple_cover_action == 'close' }}"
                    sequence:
                      - service: cover.close_cover
                        target:
                          entity_id: "{{ l2_center_triple_cover }}"
                  - conditions: "{{ l2_center_triple_cover_action == 'stop' }}"
                    sequence:
                      - service: cover.stop_cover
                        target:
                          entity_id: "{{ l2_center_triple_cover }}"
          - conditions: "{{ l2_center_triple_type == 'light' and l2_light != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l2_center_triple_action == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ l2_light }}"
                  - conditions: "{{ l2_center_triple_action == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                  - conditions: "{{ l2_center_triple_action == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ l2_light }}"
                  - conditions: "{{ l2_center_triple_action == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 25
                  - conditions: "{{ l2_center_triple_action == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 50
                  - conditions: "{{ l2_center_triple_action == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 75
                  - conditions: "{{ l2_center_triple_action == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 100

  # Layer 2 – Center Hold
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l2_center' and (event_type == 'initial_press' or event_type == 'repeat') }}"
    then:
      - choose:
          - conditions: "{{ l2_center_hold_type == 'scene' and l2_center_hold_scene != '' }}"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: "{{ l2_center_hold_scene }}"
          - conditions: "{{ l2_center_hold_type == 'cover' and l2_center_hold_cover != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l2_center_hold_cover_action == 'toggle' }}"
                    sequence:
                      - service: cover.toggle
                        target:
                          entity_id: "{{ l2_center_hold_cover }}"
                  - conditions: "{{ l2_center_hold_cover_action == 'open' }}"
                    sequence:
                      - service: cover.open_cover
                        target:
                          entity_id: "{{ l2_center_hold_cover }}"
                  - conditions: "{{ l2_center_hold_cover_action == 'close' }}"
                    sequence:
                      - service: cover.close_cover
                        target:
                          entity_id: "{{ l2_center_hold_cover }}"
                  - conditions: "{{ l2_center_hold_cover_action == 'stop' }}"
                    sequence:
                      - service: cover.stop_cover
                        target:
                          entity_id: "{{ l2_center_hold_cover }}"
          - conditions: "{{ l2_center_hold_type == 'light' and l2_light != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l2_center_hold_action == 'brightness_step' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_step_pct: "{{ l2_center_hold_step if l2_center_hold_dir == 'up' else -l2_center_hold_step }}"
                  - conditions: "{{ l2_center_hold_action == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ l2_light }}"
                  - conditions: "{{ l2_center_hold_action == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                  - conditions: "{{ l2_center_hold_action == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ l2_light }}"
                  - conditions: "{{ l2_center_hold_action == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 25
                  - conditions: "{{ l2_center_hold_action == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 50
                  - conditions: "{{ l2_center_hold_action == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 75
                  - conditions: "{{ l2_center_hold_action == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l2_light }}"
                        data:
                          brightness_pct: 100

  # Layer 2 – Right (Brightness adjustment)
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l2_right' and event_type == 'multi_press_1' and l2_light != '' }}"
    then:
      - service: light.turn_on
        target:
          entity_id: "{{ l2_light }}"
        data:
          brightness_step_pct: "{{ l2_right_step if l2_right_dir == 'up' else -l2_right_step }}"

  # ╔══════════════════════════════════════════════════════════════════════════╗
  # ║                         LAYER 3 ACTIONS                                  ║
  # ╚══════════════════════════════════════════════════════════════════════════╝

  # Layer 3 – Left (Brightness adjustment)
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l3_left' and event_type == 'multi_press_1' and l3_light != '' }}"
    then:
      - service: light.turn_on
        target:
          entity_id: "{{ l3_light }}"
        data:
          brightness_step_pct: "{{ l3_left_step if l3_left_dir == 'up' else -l3_left_step }}"

  # Layer 3 – Center Single Press
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l3_center' and event_type == 'multi_press_1' }}"
    then:
      - choose:
          - conditions: "{{ l3_center_single_type == 'scene' and l3_center_single_scene != '' }}"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: "{{ l3_center_single_scene }}"
          - conditions: "{{ l3_center_single_type == 'cover' and l3_center_single_cover != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l3_center_single_cover_action == 'toggle' }}"
                    sequence:
                      - service: cover.toggle
                        target:
                          entity_id: "{{ l3_center_single_cover }}"
                  - conditions: "{{ l3_center_single_cover_action == 'open' }}"
                    sequence:
                      - service: cover.open_cover
                        target:
                          entity_id: "{{ l3_center_single_cover }}"
                  - conditions: "{{ l3_center_single_cover_action == 'close' }}"
                    sequence:
                      - service: cover.close_cover
                        target:
                          entity_id: "{{ l3_center_single_cover }}"
                  - conditions: "{{ l3_center_single_cover_action == 'stop' }}"
                    sequence:
                      - service: cover.stop_cover
                        target:
                          entity_id: "{{ l3_center_single_cover }}"
          - conditions: "{{ l3_center_single_type == 'light' and l3_light != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l3_center_single_action == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ l3_light }}"
                  - conditions: "{{ l3_center_single_action == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                  - conditions: "{{ l3_center_single_action == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ l3_light }}"
                  - conditions: "{{ l3_center_single_action == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 25
                  - conditions: "{{ l3_center_single_action == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 50
                  - conditions: "{{ l3_center_single_action == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 75
                  - conditions: "{{ l3_center_single_action == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 100

  # Layer 3 – Center Double Press
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l3_center' and event_type == 'multi_press_2' }}"
    then:
      - choose:
          - conditions: "{{ l3_center_double_type == 'scene' and l3_center_double_scene != '' }}"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: "{{ l3_center_double_scene }}"
          - conditions: "{{ l3_center_double_type == 'cover' and l3_center_double_cover != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l3_center_double_cover_action == 'toggle' }}"
                    sequence:
                      - service: cover.toggle
                        target:
                          entity_id: "{{ l3_center_double_cover }}"
                  - conditions: "{{ l3_center_double_cover_action == 'open' }}"
                    sequence:
                      - service: cover.open_cover
                        target:
                          entity_id: "{{ l3_center_double_cover }}"
                  - conditions: "{{ l3_center_double_cover_action == 'close' }}"
                    sequence:
                      - service: cover.close_cover
                        target:
                          entity_id: "{{ l3_center_double_cover }}"
                  - conditions: "{{ l3_center_double_cover_action == 'stop' }}"
                    sequence:
                      - service: cover.stop_cover
                        target:
                          entity_id: "{{ l3_center_double_cover }}"
          - conditions: "{{ l3_center_double_type == 'light' and l3_light != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l3_center_double_action == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ l3_light }}"
                  - conditions: "{{ l3_center_double_action == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                  - conditions: "{{ l3_center_double_action == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ l3_light }}"
                  - conditions: "{{ l3_center_double_action == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 25
                  - conditions: "{{ l3_center_double_action == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 50
                  - conditions: "{{ l3_center_double_action == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 75
                  - conditions: "{{ l3_center_double_action == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 100

  # Layer 3 – Center Triple Press
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l3_center' and event_type == 'multi_press_3' }}"
    then:
      - choose:
          - conditions: "{{ l3_center_triple_type == 'scene' and l3_center_triple_scene != '' }}"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: "{{ l3_center_triple_scene }}"
          - conditions: "{{ l3_center_triple_type == 'cover' and l3_center_triple_cover != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l3_center_triple_cover_action == 'toggle' }}"
                    sequence:
                      - service: cover.toggle
                        target:
                          entity_id: "{{ l3_center_triple_cover }}"
                  - conditions: "{{ l3_center_triple_cover_action == 'open' }}"
                    sequence:
                      - service: cover.open_cover
                        target:
                          entity_id: "{{ l3_center_triple_cover }}"
                  - conditions: "{{ l3_center_triple_cover_action == 'close' }}"
                    sequence:
                      - service: cover.close_cover
                        target:
                          entity_id: "{{ l3_center_triple_cover }}"
                  - conditions: "{{ l3_center_triple_cover_action == 'stop' }}"
                    sequence:
                      - service: cover.stop_cover
                        target:
                          entity_id: "{{ l3_center_triple_cover }}"
          - conditions: "{{ l3_center_triple_type == 'light' and l3_light != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l3_center_triple_action == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ l3_light }}"
                  - conditions: "{{ l3_center_triple_action == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                  - conditions: "{{ l3_center_triple_action == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ l3_light }}"
                  - conditions: "{{ l3_center_triple_action == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 25
                  - conditions: "{{ l3_center_triple_action == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 50
                  - conditions: "{{ l3_center_triple_action == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 75
                  - conditions: "{{ l3_center_triple_action == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 100

  # Layer 3 – Center Hold
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l3_center' and (event_type == 'initial_press' or event_type == 'repeat') }}"
    then:
      - choose:
          - conditions: "{{ l3_center_hold_type == 'scene' and l3_center_hold_scene != '' }}"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: "{{ l3_center_hold_scene }}"
          - conditions: "{{ l3_center_hold_type == 'cover' and l3_center_hold_cover != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l3_center_hold_cover_action == 'toggle' }}"
                    sequence:
                      - service: cover.toggle
                        target:
                          entity_id: "{{ l3_center_hold_cover }}"
                  - conditions: "{{ l3_center_hold_cover_action == 'open' }}"
                    sequence:
                      - service: cover.open_cover
                        target:
                          entity_id: "{{ l3_center_hold_cover }}"
                  - conditions: "{{ l3_center_hold_cover_action == 'close' }}"
                    sequence:
                      - service: cover.close_cover
                        target:
                          entity_id: "{{ l3_center_hold_cover }}"
                  - conditions: "{{ l3_center_hold_cover_action == 'stop' }}"
                    sequence:
                      - service: cover.stop_cover
                        target:
                          entity_id: "{{ l3_center_hold_cover }}"
          - conditions: "{{ l3_center_hold_type == 'light' and l3_light != '' }}"
            sequence:
              - choose:
                  - conditions: "{{ l3_center_hold_action == 'brightness_step' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_step_pct: "{{ l3_center_hold_step if l3_center_hold_dir == 'up' else -l3_center_hold_step }}"
                  - conditions: "{{ l3_center_hold_action == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ l3_light }}"
                  - conditions: "{{ l3_center_hold_action == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                  - conditions: "{{ l3_center_hold_action == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ l3_light }}"
                  - conditions: "{{ l3_center_hold_action == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 25
                  - conditions: "{{ l3_center_hold_action == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 50
                  - conditions: "{{ l3_center_hold_action == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 75
                  - conditions: "{{ l3_center_hold_action == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ l3_light }}"
                        data:
                          brightness_pct: 100

  # Layer 3 – Right (Brightness adjustment)
  - if:
      - condition: template
        value_template: "{{ trigger_id == 'l3_right' and event_type == 'multi_press_1' and l3_light != '' }}"
    then:
      - service: light.turn_on
        target:
          entity_id: "{{ l3_light }}"
        data:
          brightness_step_pct: "{{ l3_right_step if l3_right_dir == 'up' else -l3_right_step }}"

mode: parallel
max: 10
